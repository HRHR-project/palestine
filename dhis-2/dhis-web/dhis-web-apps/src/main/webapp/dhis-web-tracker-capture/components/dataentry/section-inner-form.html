<ng-form name="innerForm">
    <div ng-if="prStDes[de.dataElement.id].dataElement.optionSetValue">
        <div class="hideInPrint">
            <div ng-if="!selectedProgram.dataEntryMethod || optionSets[prStDes[de.dataElement.id].dataElement.optionSet.id].options.length >= 7">
                <ui-select  ng-model="currentEvent[prStDes[de.dataElement.id].dataElement.id]"
                            theme="select2"
                            ng-required={{prStDes[de.dataElement.id].compulsory}}
                            handle-dirty
                            handle-dirty-type="select"
                            ng-disabled="selectedEnrollment.status !== 'ACTIVE' || currentEvent.editingNotAllowed || assignedFields[currentEvent.event][de.dataElement.id]"
                            name="foo"
                            on-select="saveDatavalue(prStDes[de.dataElement.id], innerForm.foo)"
                            ng-style="{'width':'100%'}"/>
                    <ui-select-match allow-clear="true" ng-class="getInputNotifcationClass(prStDes[de.dataElement.id].dataElement.id,true, currentEvent)"  class="form-control-ui-select"  placeholder="{{'select_or_search' | translate}}">{{$select.selected.displayName  || $select.selected}}</ui-select-match>
                    <ui-select-choices  repeat="option.displayName as option in optionSets[prStDes[de.dataElement.id].dataElement.optionSet.id].options | filter: $select.search | limitTo:maxOptionSize">
                        <span ng-bind-html="option.displayName | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>

            </div>
            <div ng-if="selectedProgram.dataEntryMethod && optionSets[prStDes[de.dataElement.id].dataElement.optionSet.id].options.length < 7">
                <label>
                      <span>
                        <input type="radio"
                               class="form-control"
                               ng-class="getInputNotifcationClass(prStDes[de.dataElement.id].dataElement.id,false, currentEvent)"
                               name="foo"
                               ng-required={{prStDes[de.dataElement.id].compulsory}}                               
                               handle-dirty
                               ng-disabled="selectedEnrollment.status !== 'ACTIVE' || currentEvent.editingNotAllowed || assignedFields[currentEvent.event][de.dataElement.id]"
                               ng-model="currentEvent[prStDes[de.dataElement.id].dataElement.id]"
                               ng-change="saveDatavalue(prStDes[de.dataElement.id])"
                               value=""> {{'no_value' | translate}}<br>
                        </span>

                </label><br>
                    <span ng-repeat="option in optionSets[prStDes[de.dataElement.id].dataElement.optionSet.id].options">
                        <label>
                            <input type="radio"
                                   class="form-control"
                                   ng-class="getInputNotifcationClass(prStDes[de.dataElement.id].dataElement.id,false, currentEvent)"
                                   name="foo"
                                   ng-required={{prStDes[de.dataElement.id].compulsory}}                                   
                                   handle-dirty
                                   ng-disabled="selectedEnrollment.status !== 'ACTIVE' || currentEvent.editingNotAllowed || assignedFields[currentEvent.event][de.dataElement.id]"
                                   ng-model="currentEvent[prStDes[de.dataElement.id].dataElement.id]"
                                   ng-change="saveDatavalue(prStDes[de.dataElement.id])"
                                   value={{option.displayName}}> {{option.displayName}}
                        </label><br>
                    </span>
            </div>
        </div>
        <div class="not-for-screen">
            <input type="text" class="form-control" value={{currentEvent[prStDes[de.dataElement.id].dataElement.id]}}>
        </div>
    </div>
    <div ng-if="!prStDes[de.dataElement.id].dataElement.optionSetValue" ng-switch="prStDes[de.dataElement.id].dataElement.valueType">
        <div ng-switch-when="NUMBER">
            <div class="hideInPrint">
                    <input type="number"
                           d2-number-validator
                           number-type={{prStDes[de.dataElement.id].dataElement.valueType}}
                           class="form-control"
                           ng-class="getInputNotifcationClass(prStDes[de.dataElement.id].dataElement.id,false, currentEvent)"
                           ng-model="currentEvent[prStDes[de.dataElement.id].dataElement.id]"
                           ng-required={{prStDes[de.dataElement.id].compulsory}}
                           ng-disabled="selectedEnrollment.status !== 'ACTIVE' || currentEvent.editingNotAllowed || assignedFields[currentEvent.event][de.dataElement.id]"
                           ng-blur="saveDatavalue(prStDes[de.dataElement.id], innerForm.foo)"
                           on-editing-css-class="form-element-changing"
                           handle-dirty
                           name="foo"/>
            </div>
            <div class="not-for-screen">
                <input type="text" class="form-control" value={{currentEvent[prStDes[de.dataElement.id].dataElement.id]}}>
            </div>
        </div>
        <div ng-switch-when="INTEGER">
            <div class="hideInPrint">
                <input type="number"
                       d2-number-validator
                       number-type={{prStDes[de.dataElement.id].dataElement.valueType}}
                       class="form-control"
                       ng-class="getInputNotifcationClass(prStDes[de.dataElement.id].dataElement.id,false, currentEvent)"
                       ng-model="currentEvent[prStDes[de.dataElement.id].dataElement.id]"
                       ng-required={{prStDes[de.dataElement.id].compulsory}}
                       ng-disabled="selectedEnrollment.status !== 'ACTIVE' || currentEvent.editingNotAllowed || assignedFields[currentEvent.event][de.dataElement.id]"
                       ng-blur="saveDatavalue(prStDes[de.dataElement.id], innerForm.foo)"
                       on-editing-css-class="form-element-changing"
                       handle-dirty
                       name="foo" />
            </div>
            <div class="not-for-screen">
                <input type="text" class="form-control" value={{currentEvent[prStDes[de.dataElement.id].dataElement.id]}}>
            </div>
        </div>
        <div ng-switch-when="INTEGER_POSITIVE">
            <div class="hideInPrint">
                <input type="number"
                       d2-number-validator
                       number-type={{prStDes[de.dataElement.id].dataElement.valueType}}
                       class="form-control"
                       ng-class="getInputNotifcationClass(prStDes[de.dataElement.id].dataElement.id,false, currentEvent)"
                       ng-model="currentEvent[prStDes[de.dataElement.id].dataElement.id]"
                       ng-required={{prStDes[de.dataElement.id].compulsory}}
                       ng-disabled="selectedEnrollment.status !== 'ACTIVE' || currentEvent.editingNotAllowed || assignedFields[currentEvent.event][de.dataElement.id]"
                       ng-blur="saveDatavalue(prStDes[de.dataElement.id], innerForm.foo)"
                       on-editing-css-class="form-element-changing"
                       handle-dirty
                       name="foo"/>
            </div>
            <div class="not-for-screen">
                <input type="text" class="form-control" value={{currentEvent[prStDes[de.dataElement.id].dataElement.id]}}>
            </div>
        </div>
        <div ng-switch-when="INTEGER_NEGATIVE">
            <div class="hideInPrint">
                <input type="number"
                       d2-number-validator
                       number-type={{prStDes[de.dataElement.id].dataElement.valueType}}
                       class="form-control"
                       ng-class="getInputNotifcationClass(prStDes[de.dataElement.id].dataElement.id,false, currentEvent)"
                       ng-model="currentEvent[prStDes[de.dataElement.id].dataElement.id]"
                       ng-required={{prStDes[de.dataElement.id].compulsory}}
                       ng-disabled="selectedEnrollment.status !== 'ACTIVE' || currentEvent.editingNotAllowed || assignedFields[currentEvent.event][de.dataElement.id]"
                       ng-blur="saveDatavalue(prStDes[de.dataElement.id], innerForm.foo)"
                       on-editing-css-class="form-element-changing"
                       handle-dirty
                       name="foo"/>
            </div>
            <div class="not-for-screen">
                <input type="text" class="form-control" value={{currentEvent[prStDes[de.dataElement.id].dataElement.id]}}>
            </div>
        </div>
        <div ng-switch-when="INTEGER_ZERO_OR_POSITIVE">
            <div class="hideInPrint">
                <input type="number"
                       d2-number-validator
                       number-type={{prStDes[de.dataElement.id].dataElement.valueType}}
                       class="form-control"
                       ng-class="getInputNotifcationClass(prStDes[de.dataElement.id].dataElement.id,false, currentEvent)"
                       ng-model="currentEvent[prStDes[de.dataElement.id].dataElement.id]"
                       ng-required={{prStDes[de.dataElement.id].compulsory}}
                       ng-disabled="selectedEnrollment.status !== 'ACTIVE' || currentEvent.editingNotAllowed || assignedFields[currentEvent.event][de.dataElement.id]"
                       ng-blur="saveDatavalue(prStDes[de.dataElement.id], innerForm.foo)"
                       on-editing-css-class="form-element-changing"
                       handle-dirty
                       name="foo"/>
            </div>
            <div class="not-for-screen">
                <input type="text" class="form-control" value={{currentEvent[prStDes[de.dataElement.id].dataElement.id]}}>
            </div>
        </div>

        <div ng-switch-when="BOOLEAN">
            <div class="hideInPrint">
                <dhis2-radio-button
                    ng-required="prStDes[de.dataElement.id].compulsory"
                    dh-disabled="selectedEnrollment.status !== 'ACTIVE' || currentEvent.editingNotAllowed || assignedFields[currentEvent.event][de.dataElement.id] === true"      
                    dh-use-external-button-color-exp="true"
                    dh-button-color-class="getInputNotifcationClass(prStDes[de.dataElement.id].dataElement.id, false, currentEvent, value, true)"
                    dh-id="de.dataElement.id"   
                    name="foo"
                    ng-model="currentEvent[prStDes[de.dataElement.id].dataElement.id]"
                    handle-dirty
                    handle-dirty-type="dhis2RadioButton"
                    dh-click="saveDataValueForRadio(prStDes[de.dataElement.id], currentEvent, value)">
                </dhis2-radio-button>
            </div>
            <div class="not-for-screen">
                <label class="radio-inline"><input type="radio" ng-checked="{{currentEvent[prStDes[de.dataElement.id].dataElement.id] === 'true'}}">{{'yes' | translate}}</label>
                <label class="radio-inline"><input type="radio" ng-checked="{{currentEvent[prStDes[de.dataElement.id].dataElement.id] === 'false'}}">{{'no' | translate}}</label>
            </div>
        </div>
        <div ng-switch-when="DATE">
            <div class="hideInPrint">
                <input type="text"
                       placeholder="{{dhis2CalendarFormat.keyDateFormat}}"
                       d2-date
                       d2-date-validator
                       max-date="prStDes[de.dataElement.id].allowFutureDate ? '' : 0"
                       class="form-control"
                       ng-class="getInputNotifcationClass(prStDes[de.dataElement.id].dataElement.id,false, currentEvent)"
                       ng-model="currentEvent[prStDes[de.dataElement.id].dataElement.id]"
                       ng-required={{prStDes[de.dataElement.id].compulsory}}
                       ng-disabled="selectedEnrollment.status !== 'ACTIVE' || currentEvent.editingNotAllowed || assignedFields[currentEvent.event][de.dataElement.id]"
                       blur-or-change="saveDatavalue(prStDes[de.dataElement.id])"
                       handle-dirty
                       name="foo"/>
            </div>
            <div class="not-for-screen">
                <input type="text" class="form-control" value={{currentEvent[prStDes[de.dataElement.id].dataElement.id]}}>
            </div>
        </div>
        <div ng-switch-when="TIME">
            <d2-time time-model="currentEvent"
                     time-model-id="prStDes[de.dataElement.id].dataElement.id"
                     time-required="isCompulsory(de)"
                     time-save-methode="saveDatavalue"
                     time-save-methode-parameter1="prStDes[de.dataElement.id]"
                     time-use-notification="true"
                     time-element="currentElement"
                     time-disabled="selectedOrgUnit.closedStatus || selectedEnrollment.status !== 'ACTIVE' || currentEvent.editingNotAllowed || assignedFields[currentEvent.event][de.id] ? true : false"
                     time-format="prStDes[de.dataElement.id].dataElement.code">
            </d2-time>
        </div>
        <div ng-switch-when="TRUE_ONLY">
            <div class="hideInPrint">
                <input type="checkbox"
                       class="form-control-checkbox"
                       ng-model="currentEvent[prStDes[de.dataElement.id].dataElement.id]"
                       ng-required={{prStDes[de.dataElement.id].compulsory}}
                       ng-disabled="selectedEnrollment.status !== 'ACTIVE' || currentEvent.editingNotAllowed || assignedFields[currentEvent.event][de.dataElement.id]"
                       ng-change="saveDatavalue(prStDes[de.dataElement.id], innerForm.foo)"
                       handle-dirty
                       name="foo"/>
            </div>
            <div class="not-for-screen">
                <input type="checkbox" class="form-control-checkbox" ng-checked={{currentEvent[prStDes[de.dataElement.id].dataElement.id]}}>
            </div>
        </div>
        <div ng-switch-when="MULTI_SELECT_GROUP">
            <div class="hideInPrint">
                <ui-select  ng-model="currentEvent[prStDes[de.dataElement.id].dataElement.id].selections"
                            id="multiSelectGroup"
                            ng-init="initMultiSelect(currentEvent)"
                            theme="select2"
                            ng-required={{prStDes[de.dataElement.id].compulsory}}
                            ng-disabled="selectedEnrollment.status !== 'ACTIVE' || currentEvent.editingNotAllowed"
                            name="foo"
                            handle-dirty
                            multiple
                            on-remove="saveMultiSelectState($item,currentEvent,prStDes[de.dataElement.id],false)"
                            on-select="saveMultiSelectState($item,currentEvent,prStDes[de.dataElement.id],true)"
                            ng-style="{'width': '100%'}">
                    <ui-select-match allow-clear="true" ng-class={{getInputNotifcationClass(de.dataElement.id,false)}}  class="form-control-ui-select"  placeholder="{{'select_or_search' | translate}}" >{{$item.dataElement.displayFormName ? $item.dataElement.displayFormName : $item.dataElement.displayName }}</ui-select-match>
                    <ui-select-choices repeat="prStDe.dataElement as prStDe in currentStage.multiSelectGroups[de.dataElement.id].dataElements | filter: $select.search | limitTo:maxOptionSize">
                        <span ng-bind-html="prStDe.dataElement.displayFormName ? prStDe.dataElement.displayFormName : prStDe.dataElement.displayName | highlight: $select.search"></span>
                    </ui-select-choices>
                </ui-select>
            </div>
            <div class="not-for-screen">
                <input type="text" class="form-control" value={{currentEvent[de.dataElement.id]}}>
            </div>
        </div>
        <div ng-switch-when="LONG_TEXT">
            <div class="hideInPrint">
                    <textarea rows="3"
                              class="form-control"

                              ng-class="getInputNotifcationClass(prStDes[de.dataElement.id].dataElement.id,false, currentEvent)"
                              ng-model="currentEvent[prStDes[de.dataElement.id].dataElement.id]"
                              ng-required={{prStDes[de.dataElement.id].compulsory}}
                              ng-disabled="selectedEnrollment.status !== 'ACTIVE' || currentEvent.editingNotAllowed || assignedFields[currentEvent.event][de.dataElement.id]"
                              ng-blur="saveDatavalue(prStDes[de.dataElement.id], innerForm.foo)"
                              on-editing-css-class="form-element-changing"
                              handle-dirty
                              name="foo"></textarea>
            </div>
            <div class="not-for-screen">
                <textarea rows="3" class="form-control" value={{currentEvent[prStDes[de.dataElement.id].dataElement.id]}}></textarea>
            </div>
        </div>
        <div ng-switch-when="TEXT">
            <div class="hideInPrint">
                <input type="text"
                       class="form-control"
                       ng-class="getInputNotifcationClass(prStDes[de.dataElement.id].dataElement.id,false, currentEvent)"
                       ng-model="currentEvent[prStDes[de.dataElement.id].dataElement.id]"
                       ng-required={{prStDes[de.dataElement.id].compulsory}}
                       ng-disabled="selectedEnrollment.status !== 'ACTIVE' || currentEvent.editingNotAllowed || assignedFields[currentEvent.event][de.dataElement.id]"
                       ng-blur="saveDatavalue(prStDes[de.dataElement.id], innerForm.foo)"
                       on-editing-css-class="form-element-changing"
                       handle-dirty
                       name="foo"/>
            </div>
            <div class="not-for-screen">
                <input type="text" class="form-control" value={{currentEvent[prStDes[de.dataElement.id].dataElement.id]}}>
            </div>
        </div>
        <div ng-switch-when="FILE_RESOURCE">
            <div class="hideInPrint">
                <div class="input-group">
                    <div class="form-control">
                        <a href ng-click="downloadFile(currentEvent.event, de.dataElement.id)">{{fileNames[currentEvent.event][de.dataElement.id]}}</a>
                    </div>
                        <span class="input-group-btn">
                            <span class="btn btn-primary btn-file" ng-click="deleteFile(currentEvent,de.dataElement.id)" ng-if="currentEvent[de.dataElement.id]">
                                <span
                                      title="{{'delete' | translate}}"
                                      d2-file-input-name="fileNames[currentEvent.event][de.dataElement.id]"
                                      d2-file-input-delete="currentEvent[de.dataElement.id]">
                                    <i class="fa fa-trash"></i>
                                </span>
                            </span>
                            <span class="btn btn-primary btn-file" ng-if="!currentEvent[de.dataElement.id]">
                                <span title="{{'upload' | translate}}">
                                    <i class="fa fa-upload"></i>
                                    <input type="file"
                                           ng-required={{prStDes[de.dataElement.id].compulsory}}
                                           ng-disabled="assignedFields[de.dataElement.id]"
                                           name="foo"
                                           input-field-id={{de.dataElement.id}}
                                           d2-file-input-ps="currentStage"
                                           d2-file-input="currentEvent"
                                           d2-file-input-current-name="currentFileNames"
                                           d2-file-input-name="fileNames">
                                </span>
                            </span>
                        </span>
                </div>
            </div>
            <div class="not-for-screen">
                <input type="text" class="form-control" value={{currentEvent[prStDe.dataElement.id]}}>
            </div>
        </div>
        <div ng-switch-default>
            <div class="hideInPrint">
                <input type="text"
                       class="form-control"
                       ng-class="getInputNotifcationClass(prStDes[de.dataElement.id].dataElement.id,false, currentEvent)"
                       ng-model="currentEvent[prStDes[de.dataElement.id].dataElement.id]"
                       ng-required={{prStDes[de.dataElement.id].compulsory}}
                       ng-disabled="selectedEnrollment.status !== 'ACTIVE' || currentEvent.editingNotAllowed || assignedFields[currentEvent.event][de.dataElement.id]"
                       ng-blur="saveDatavalue(prStDes[de.dataElement.id])"
                       on-editing-css-class="form-element-changing"
                       handle-dirty
                       name="foo"/>
            </div>
            <div class="not-for-screen">
                <input type="text" class="form-control" value={{currentEvent[prStDes[de.dataElement.id].dataElement.id]}}>
            </div>
        </div>
        
    </div>    
    
    <div ng-messages="innerForm.foo.$error" ng-if="interacted(innerForm.foo[currentEvent.event], currentEvent) && printMode !== true" class="required" ng-messages-include="../dhis-web-commons/angular-forms/error-messages.html">
    </div>
    <div class="alert alert-warning alert-dismissible" role="alert" ng-if="warningMessages[currentEvent.event][de.dataElement.id] && printMode !== true">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        {{warningMessages[currentEvent.event][de.dataElement.id]}}
    </div>
    <div class="alert alert-danger alert-dismissible" role="alert" ng-if="errorMessages[currentEvent.event][de.dataElement.id] && printMode !== true">
        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        {{errorMessages[currentEvent.event][de.dataElement.id]}}
    </div>
    
</ng-form>